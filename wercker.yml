build:

  box:

    id: marclewis/ubuntu_nginx_node
    username: $DOCKER_HUB_USERNAME
    password: $DOCKER_HUB_PASSWORD
    tag: latest

#   Any Connected containers
#  services:
#    - mongodb
#    - nginx

  steps:

    - script:

      name: Remove the default Nginx configuration file
      code: rm -v /etc/nginx/nginx.conf

    - script:

      name: Add the correct Nginx configuration file
      code: cp nginx.conf /etc/nginx/

    - script:

      name: Add the app to /var/www for nginx
      code: cp -r ./app /var/www

  steps:

    # Change the working directory for npm install
    cwd: /var/www

    - script:

      name: Install dependencies
      code: npm install

    - script:

      name: Install pm2 globall
      code: npm install pm2 -g



deploy:

  dockerhub:

    - internal/docker-push:

      username: $DOCKER_HUB_USERNAME
      password: $DOCKER_HUB_PASSWORD
      repository: marclewis/potrainto

